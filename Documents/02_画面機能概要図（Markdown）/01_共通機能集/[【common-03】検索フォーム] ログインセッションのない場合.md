# [【common-03】検索フォーム] ログインセッションのない場合

- 【common-03】機能説明
  - 特徴・機能
    - フォームにキーワードと検索条件を入力して、ノート・ビデオを検索する
      - 検索対象
        - テーブル[ulinker_notes]に登録されている、publicity=1（公開設定）のレコード
        - テーブル[ulinker_videos]に登録されている、publicity=1（公開設定）のレコード
    - 検索ワード入力欄に入力されたキーワードで、対話型 AI に入力するプロンプトを作成する
  - 関連機能
    - [【common-04】検索結果表示ノートエリア]
    - [【common-05】検索結果表示ビデオエリア]
  - 関連変数
    - flag.isSearchFormOpen（boolean 型。初期状態は false）
- 【common-03-01】検索ワード入力欄
  - 特徴・機能
    - 入力されたキーワードが、ノート・ビデオ検索、及び対話型 AI に入力するプロンプト作成に用いられる
    - 「検索ワード」のラベルを入力欄に設定する
  - 関連変数
    - searchForm.keyword（String 型）
- 【common-03-02】除外ワード入力欄
  - 特徴・機能
    - ここに入力されたキーワードは、検索し取得されたノート・ビデオのうち、これを含むレコードを除外する際に用いられる
      - タイトル/本文・タグ切り替えボタンでの選択により、除外判定の対象が変わる
        - 「タイトル」の場合は、除外ワードをタイトルに含むノート・ビデオのレコードが除外される
        - 「本文・タグ」の場合は、除外ワードをノートの本文またはビデオのタグに含むレコードが除外される
      - 半角スペースで区切ることで、複数の除外ワードを指定できる
    - 「除外ワード」のラベルを入力欄に設定する
  - 関連変数
    - searchForm.excludeWord（String 型）
- 【common-03-03】タイトル/本文・タグ切り替えボタン
  - 特徴・機能
    - 現在の検索時にキーワードを含む対象を表示する。押下することで検索モードを切り替えることができる
      - 入力されたキーワードが、(1)ノート・ビデオのタイトルに含まれる場合に検索結果に表示するか
      - 入力されたキーワードが、(2)ノート本文またはビデオのタグのどちらに含まれる場合に検索結果に表示するか
    - ボタンの左側には「キーワードを含む対象」のラベルを表示する
  - 関連変数
    - searchForm.includeFor（int 型。0 で(1)の場合を、1 で(2)の場合を示す。初期状態は 0）
- 【common-03-04】AND/OR 切り替えボタン
  - 特徴・機能
    - 現在の検索モードを表示する。押下することで検索モードを切り替えることができる
      - 入力されたキーワードが半角スペースを含んでいる場合に
      - (1)半角スペースで区切った各キーワードがすべて含まれている場合に検索結果に表示するか
      - (2)半角スペースで区切った各キーワードのうちのいずれかを含んでいる場合に検索結果に表示するか
    - ボタンの左側には「検索モード」のラベルを表示する
  - 関連変数
    - searchForm.andOr（int 型。0 で(1)の場合を、1 で(2)の場合を示す。初期状態は 0）
- 【common-03-05】登録ユーザー名入力欄
  - 特徴・機能
    - 入力された文字列が[ulinker_accounts.user_name]に含まれているユーザーの登録ノート・ビデオだけを対象に検索するよう設定する
    - 入力内容に半角スペースが含まれていた場合は、半角スペースで区切ったうちの先頭を含有対象とする
    - 「登録ユーザー名」のラベルを入力欄に設定する
  - 関連変数
    - searchForm.createdBy（String 型）
- 【common-03-06】登録日時範囲選択カレンダー
  - 特徴・機能
    - 開始日と終了日を設定することで期間を絞り込み、その間に登録されたノート・ビデオを検索対象とする
    - 入力欄の左側には「表示対象期間」のラベルを表示する
    - 場合分け
      - 開始日・終了日とも設定なし
        - 全期間のノート・ビデオを対象に検索
      - 開始日・終了日とも設定あり
        - その期間に登録されたノート・ビデオを対象に検索
      - 開始日のみ設定あり
        - その開始日以降に登録されたノート・ビデオを対象に検索
      - 終了日のみ設定あり
        - その終了日以前に登録されたノート・ビデオを対象に検索
  - 【common-03-06-01】開始日
    - 特徴・機能
      - 入力欄（初期表示は yyyy/mm/dd）に数字を入力するか、カレンダーを表示して日付を選択することで、開始日を設定する
        - 入力欄は数字以外は入力できない
        - カレンダーアイコンを押下するとカレンダーが表示される
      - 「開始日」のラベルを入力欄に設定する
    - 関連変数
      - searchForm.startDate（data 型。yyyy-mm-dd 形式）
  - 【common-03-06-02】終了日
    - 特徴・機能
      - 入力欄（初期表示は yyyy/mm/dd）に数字を入力するか、カレンダーを表示して日付を選択することで、終了日を設定する
        - 入力欄は数字以外は入力できない
        - カレンダーアイコンを押下するとカレンダーが表示される
      - 「終了日」のラベルを入力欄に設定する
    - 関連変数
      - searchForm.endDate（data 型。yyyy-mm-dd 形式）
- 【common-03-07】表示件数プルダウン
  - 特徴・機能
    - 検索結果を[【common-04】検索結果表示ノートエリア]と[【common-05】検索結果表示ビデオエリア]に表示する各最大件数を設定する
    - タイトル/本文・タグ切り替えボタン、AND/OR 切り替えボタンと同じ並びに配置する
  - 【common-03-07-01】[10,50,100,500]
    - 特徴・機能
      - この選択肢の中から選んで押下することで最大表示件数を設定できる
      - 初期状態は先頭の 10
    - 関連変数
      - searchForm.limitNum（int 型。初期状態は 10）
- 【common-03-08】対話型 AI プロンプト構成項目チェックリストエリア
  - 特徴・機能
    - 検索ワード入力欄に入力された文字列を用いて、対話型 AI のプロンプトに入力できる質問集を作成する
      - 検索ワードに半角スペースが含まれていた場合は、半角スペースで区切ったうちの先頭が対象文字列となる
    - 作成された質問集は、検索＆プロンプト作成ボタン押下後に、対話型 AI プロンプト入力ボックスに反映される
    - 作成されるプロンプトテキストの例
      - 『次の質問にお答えください。』
      - 『```』
      - 『- {各プロンプト文の内容}』
      - 『```』
      - 『上記の内容でよろしくお願いします。』
  - 関連変数
    - searchForm.aiPrompt（String 型）
  - 【common-03-08-01】基本形
    - 特徴・機能
      - 「基本型」の見出しの右横にチェックボックスがあり、見出し右端には「+/-」ボタンがある
      - 「+/-」ボタンの初期状態は「+」。押下するとこの表示が切り替わり、子要素のチェックリストエリアが表示される
      - 「+/-」ボタンの表示が「-」の時に押下すると、子要素のチェックリストエリアが非表示になる
        - 子要素のチェックリストにチェックをつけていた場合、そのチェックが無効になることはない
      - 「基本型」の見出し右横のチェックボックスにチェックをつけると、子要素のすべてのチェックリストにチェックがつく
      - 子要素のどれかでチェックを解除すると、「基本型」の見出し右横のチェックボックスもチェックが外れる
      - この時、これ以外のチェックボックスのチェックには影響はない
    - 【common-03-08-01-01】定義について教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}とはどのようなものですか？』
    - 【common-03-08-01-02】例文を作ってもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}というワードを使って簡単な例文を作ってみてください。』
    - 【common-03-08-01-03】印象的なエピソードを教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}にまつわる印象的なエピソードがありましたら教えてください。』
    - 【common-03-08-01-04】連想される単語をいくつか教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}から連想される単語を３～５個挙げてください。』
    - 【common-03-08-01-05】記憶しやすいストーリー文を作ってもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- 語呂合わせなども活用して、{検索語}を記憶しやすいストーリー文を作ってみてください。』
  - 【common-03-08-02】問題・事件などネガティブなこと
    - 特徴・機能
      - 「基本型」の見出しと同様の機能
    - 【common-03-08-02-01】発生してしまった原因を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}が発生してしまった原因には、どういった事が考えられますか？』
    - 【common-03-08-02-02】不利益を被った人や対象を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}では、どういった人や対象が何かしらの不利益を被っているといえそうですか？』
    - 【common-03-08-02-03】なかなか解決・改善しない原因を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}がなかなか解決または改善しない原因には、どういった事が考えられますか？』
    - 【common-03-08-02-04】再発防止のための有効な手立てをおしえてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}のようなことをまた起こさないためには、どういった事ができそうですか？』
  - 【common-03-08-03】人為的にできたもの
    - 特徴・機能
      - 「基本型」の見出しと同様の機能
    - 【common-03-08-03-01】できた背景について教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}ができた背景について教えてください。』
    - 【common-03-08-03-02】起きた変化や良い効果について教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}ができたことで、どのような良い効果や反響がありましたか？』
    - 【common-03-08-03-03】メリット／デメリットについて教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}にはどういうメリット／デメリットがあると考えられますか？』
    - 【common-03-08-03-04】推進した代表的な人物を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}を推進した代表的な人物が分かる場合は教えてください。』
  - 【common-03-08-04】人物
    - 特徴・機能
      - 「基本型」の見出しと同様の機能
    - 【common-03-08-04-01】その人の特徴を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}はどういう特徴のある人物といえそうですか？』
    - 【common-03-08-04-02】特徴的な実績を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}の打ち立てた特徴的な実績があれば教えてください。』
    - 【common-03-08-04-03】深い関係のある人物を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}と深い関係のある人物がいれば教えてください。』
    - 【common-03-08-04-04】利害関係のある人物や団体・組織を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}と利害関係のある人物や団体・組織があれば教えてください。』
  - 【common-03-08-05】地域
    - 特徴・機能
      - 「基本型」の見出しと同様の機能
    - 【common-03-08-05-01】名物や有名な特産品を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}はどんな名物や特産品で有名ですか？』
    - 【common-03-08-05-02】特有の文化や特徴的な古くからの風習を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}に特有の文化や古くからの風習、お祭りなどがあれば教えてください。』
    - 【common-03-08-05-03】歴史上特に有名な出来事を教えてもらう
      - 特徴・機能
        - チェックしてプロンプト生成を実行すると次の文がプロンプトに反映される
          - 『- {検索語}の歴史で特に有名な出来事を教えてください。』
- 【common-03-09】対話型 AI プロンプト入力ボックス
  - 特徴・機能
    - 対話型 AI プロンプト構成項目チェックリストエリアでチェックされた項目で、プロンプトを生成して反映する
    - 初期状態は非表示
      - 検索＆プロンプト作成ボタンを押下することで、チェックされた項目を反映した入力ボックスが表示される
    - 作成されるプロンプトテキストの例は、対話型 AI プロンプト構成項目チェックリストエリアの説明に記載
    - 「生成されたプロンプト」のラベルを入力欄に設定する
  - 関連変数
    - searchForm.aiPrompt（String 型）
- 【common-03-10】対話型 AI プロンプト入力ボックスコピーボタン
  - 特徴・機能
    - 対話型 AI プロンプト入力ボックスに入力されている内容をクリップボードにコピーする
    - 初期状態は非表示
      - 対話型 AI プロンプト入力ボックスが表示されると連動で表示される
    - 押下すると、対話型 AI プロンプト入力ボックスの入力内容がクリップボードにコピーされる
      - クリップボードへのコピー処理を完了した後に、ボタン下にその旨を示すメッセージを 3 秒間表示する
  - 関連変数
    - searchForm.aiPrompt（String 型）
- 【common-03-11】検索＆プロンプト作成ボタン
  - 特徴・機能
    - 変数「searchForm」の内容に基づいて、次の処理が実行される
      - テーブル[ulinker_notes]、[ulinker_videos]を検索する
        - オブジェクト変数「param」に格納したデータをサーバー API へと送信し、検索した結果を取得する
        - 検索した結果を[【common-04】検索結果表示ノートエリア]と[【common-05】検索結果表示ビデオエリア]に表示する
          - 変数「isHitNoteAreaOpen」 を true にする
          - 変数「isHitVideoAreaOpen」 を true にする
      - 生成されたプロンプトを対話型 AI プロンプト入力ボックスに反映する
      - 対話型 AI プロンプト入力ボックスと、対話型 AI プロンプト入力ボックスコピーボタンを表示する
    - サーバー側 API に送信するオブジェクト変数「param」には、次の内容を格納する
      - 『type: "search"』
      - 『keyword: searchForm.keyword』
      - 『excludeWord: searchForm.excludeWord』
      - 『includeFor: searchForm.includeFor』
      - 『andOr: searchForm.andOr』
      - 『createdBy: searchForm.createdBy』
      - 『startDate: searchForm.startDate』
      - 『endDate: searchForm.endDate』
      - 『limitNum: searchForm.limitNum』
      - 『token: {ランダムな半角英数字 16 文字}』
  - 関連変数
    - searchForm（Object 型）
    - flag.isHitNoteAreaOpen（boolean 型。初期状態は false）
    - flag.isHitVideoAreaOpen（boolean 型。初期状態は false）
- 【common-03-12】Perplexity-ai にアクセスボタン
  - 特徴・機能
    - Perplexity-ai のブラウザページに別タブ遷移できるボタン
    - 初期状態は非表示。検索実行後に表示される
  - 関連変数
    - 設定なし
- 【common-03-13】リロードボタン
  - 特徴・機能
    - リロード実行確認モーダルを表示する
      - リロード実行確認モーダルで「はい」が押下されるとリロードが実行される
  - 関連変数
    - dialog.isReloadConfirmOpen（boolean 型。初期状態は false）
